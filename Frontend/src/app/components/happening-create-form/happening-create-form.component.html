
<form [formGroup]="happeningForm" (ngSubmit)="submit()" style="width: 240px">

  <div class="mb-4">
    <label for="name" class="form-label"
           [ngClass]="{'text-danger': isInvalid('name'),
                     'text-muted': !isInvalid('name')}">
      @if(isInvalid('name')){Name of the happening is required}@else{Name}
    </label>
    <input id="name"
           formControlName="name"
           type="text"
           class="form-control"
           [class.is-invalid]="isInvalid('name')" />
  </div>

  <div class="mb-4">
    <label for="startDate" class="form-label"
           [ngClass]="{'text-danger': isInvalid('startDate'),
                     'text-muted': !isInvalid('startDate')}">
      @if(isInvalid('startDate')){Start date is required}@else{Start date}
    </label>
    <input id="startDate"
           formControlName="startDate"
           type="date"
           class="form-control"
           [class.is-invalid]="isInvalid('startDate')" />
  </div>

  <div class="mb-4">
    <label for="endDate" class="form-label text-muted">End date</label>
    <input id="endDate"
           formControlName="endDate"
           type="date"
           class="form-control" />
  </div>

  <div formArrayName="happeningArtists" class="mb-3">
    <h5>Artists</h5>
    @for (artistCtrl of happeningArtists.controls; let i = $index; track artistCtrl) {
    <div [formGroupName]="i" class="mb-2">
      @if (happeningArtists.at(i).get('spotifyId')?.invalid
      && happeningArtists.at(i).get('spotifyId')?.touched){
      <div class="text-danger">Search and pick an artist from the list or remove it.</div>
      }
      <app-artist-search (artistSelected)="onArtistSelected($event, i)"
                         (deleteMe)="onArtistRemove(i)">
        [class.is-invalid]="happeningArtists.at(i).get('spotifyId')?.invalid
        && happeningArtists.at(i).get('spotifyId')?.touched">
        >
      </app-artist-search>
    </div>
    }
    <button type="button" (click)="addArtist()" class="btn btn-secondary">Add Artist</button>
  </div>
  <button type="submit"
          class="mt-4 px-4 py-2 rounded shadow">
    Create happening
  </button>
</form>

<div class="bottom-spacer" style="height: 120px"></div>
